---
import { Layout } from "@features/layout/Layout";
import "@styles/blog.css";
import type { Category } from "@interfaces/Category";
import { fetchAllCategories } from "@features/blog/services/fetchAllCategories";
import { fetchPostsByCategory } from "@features/blog/services/fetchPostsByCategory";
import { SectionPosts } from "@features/blog/components/SectionPosts";

export async function getStaticPaths() {
  const sanityCategories = await fetchAllCategories();

  return sanityCategories?.map((category) => ({
    params: {
      slug: category?.slug,
    },
    props: {
      category,
    },
  }));
}

interface Props {
  category: Category;
}

const { category } = Astro.props;

const posts = await fetchPostsByCategory(category.slug);
console.log(posts);

// const image = `${post?.mainImageUrl}?auto=format&max-w=650`;
// const canonical = `${config.url}/article/${post.slug.current}`;

const title = `Actualités ${category.title}`;
---

<Layout
  canonical={""}
  title={category.title ?? ""}
  description={category.title ?? ""}
>
  <SectionPosts label="les dernières" title={title} posts={posts} />

</Layout>
